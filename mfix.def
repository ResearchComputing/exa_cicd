#BootStrap: shub
#From: AaronTHolt/openmpi_singularity
Bootstrap: localimage
From: mfix_base.img
#Boostrap: shub:https://images1.rc.int.colorado.edu/
#From: holtat-mfix_base:latest.simg

%files
mfix /app


%post

cd /app/mfix
mkdir build
cd build
cmake -DCMAKE_CXX_COMPILER=mpic++ -DCMAKE_Fortran_COMPILER=mpif90 -DCMAKE_C_COMPILER=mpicc -DMFIX_CXX_FLAGS='-O2 -g -mavx2' -DMFIX_Fortran_FLAGS='-O2 -g -mavx2' -DCMAKE_BUILD_TYPE=RelWithDebInfo -DAMREX_ENABLE_TINY_PROFILE=1 ..
make -j4

# Edit command prompt so its short and shows you in a container
export PS1="Singularity > "


######################################################
%environment

MFIX=/app/mfix/build/mfix/mfix
export MFIX

######################################################
%runscript
export MFIX=/app/mfix/build/mfix/mfix
echo $MFIX 






#

