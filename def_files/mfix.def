BootStrap:library
From:aarontholt/default/mfix-exa:openmpi_2.1.6

#library://aarontholt/default/mfix-exa:openmpi_2.1.6


#library://library/default/alpine
#Bootstrap: library
#From: library/alpine


%files
mfix /

%post

scl enable devtoolset-7 bash

export LD_LIBRARY_PATH=/opt/rh/devtoolset-7/root/usr/lib/gcc/x86_64-redhat-linux/7:$LD_LIBRARY_PATH
export PATH=/opt/rh/devtoolset-7/root/usr/bin:$PATH

export FC=/usr/local/bin/mpif90
export CC=/usr/local/bin/mpicc
#export CXX=/usr/local/bin/mpicxx ## Breaks BLITZ build
export CXX=/opt/rh/devtoolset-7/root/usr/bin/g++

# Location to install exa
mkdir -p /app
mv /mfix /app
cd /app/mfix
mkdir build
cd build
#cmake -DCMAKE_CXX_COMPILER=mpic++ -DCMAKE_Fortran_COMPILER=mpif90 -DCMAKE_C_COMPILER=mpicc -DCMAKE_BUILD_TYPE=RelWithDebInfo -DAMREX_ENABLE_TINY_PROFILE=1 ..
cmake ..
make -j4

# Edit command prompt so its short and shows you in a container
export PS1="Singularity > "


######################################################
%environment

MFIX=/app/mfix/build/mfix/mfix
export MFIX

######################################################
%runscript
export MFIX=/app/mfix/build/mfix/mfix
echo $MFIX
